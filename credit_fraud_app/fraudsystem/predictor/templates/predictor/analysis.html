<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Analysis | Fraud Detection</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .stat-card {
            border-radius: 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            padding: 20px;
            background: #fff;
            transition: transform 0.2s ease-in-out;
        }
        .stat-card:hover { transform: translateY(-3px); }
        .stat-value { font-size: 1.5rem; font-weight: bold; }
        .container { max-width: 900px; }
        canvas { background: #fff; border-radius: 10px; padding: 10px; }
    </style>
</head>
<body class="bg-light py-4">

<div class="container">
    <h2 class="mb-4 text-center">Analysis for <span class="text-primary">{{ file_name }}</span></h2>

    <!-- Stat Cards -->
    <div class="row g-3 mb-4">
        <div class="col-md-4">
            <div class="stat-card text-center">
                <h5>Transactions</h5>
                <p class="stat-value">{{ stats.num_transactions }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card text-center">
                <h5>Average Amount</h5>
                <p class="stat-value">${{ stats.avg_amount }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card text-center">
                <h5>Fraud Count</h5>
                <p class="stat-value text-danger">{{ stats.fraud_count }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card text-center">
                <h5>Min Amount</h5>
                <p class="stat-value">${{ stats.min_amount }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card text-center">
                <h5>Max Amount</h5>
                <p class="stat-value">${{ stats.max_amount }}</p>
            </div>
        </div>
        <div class="col-md-4">
            <div class="stat-card text-center">
                <h5>Fraud Percentage</h5>
                <p class="stat-value text-danger">{{ stats.fraud_percentage }}%</p>
            </div>
        </div>
    </div>

   <!-- Charts -->
<div class="row g-4 mb-4">
    <!-- Pie Chart Container -->
    <div class="col-12 mb-4">
        <div style="width: 100%; height: 400px;">
            <canvas id="fraudPieChart"></canvas>
        </div>
    </div>

    <!-- Bar Chart Container -->
    <div class="col-12">
        <div style="width: 100%; height: 400px;">
            <canvas id="amountBarChart"></canvas>
        </div>
    </div>
</div>

<div class="text-center">
    <a href="{% url 'home' %}" class="btn btn-primary">‚Üê Back to Dashboard</a>
</div>

<script>
    // Pie chart: Fraud vs Non-Fraud
    const ctxPie = document.getElementById('fraudPieChart').getContext('2d');
    new Chart(ctxPie, {
        type: 'pie',
        data: {
            labels: ['Non-Fraud', 'Fraud'],
            datasets: [{
                label: 'Transactions',
                data: [{{ chart_data.non_fraud }}, {{ chart_data.fraud }}],
                backgroundColor: ['#4e73df', '#e74a3b'],
                borderColor: '#fff',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false, // allow full container sizing
            plugins: { legend: { position: 'bottom' } }
        }
    });

    // Bar chart: Min, Avg, Max Amount
    const ctxBar = document.getElementById('amountBarChart').getContext('2d');
    new Chart(ctxBar, {
        type: 'bar',
        data: {
            labels: ['Min Amount', 'Avg Amount', 'Max Amount'],
            datasets: [{
                label: 'Transaction Amount ($)',
                data: [{{ chart_data.amounts.min }}, {{ chart_data.amounts.avg }}, {{ chart_data.amounts.max }}],
                backgroundColor: ['#1cc88a', '#36b9cc', '#f6c23e'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false, // allow full container sizing
            plugins: { legend: { display: false } },
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>


</body>
</html>
